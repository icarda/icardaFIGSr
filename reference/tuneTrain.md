# Splitting the Data, Tuning and Training the models, and making predictions

Automatic function for tuning and training data, it returns a list
containing a model objects, data frame and plot.

## Usage

``` r
tuneTrain(
  data,
  y,
  p = 0.7,
  method = "knn",
  parallelComputing = FALSE,
  length = 10,
  control = "repeatedcv",
  number = 10,
  repeats = 10,
  process = c("center", "scale"),
  summary = multiClassSummary,
  classProbs = FALSE,
  imbalanceMethod = NULL,
  ...
)
```

## Arguments

- data:

  object of class "data.frame" with target variable and predictor
  variables.

- y:

  character. Target variable.

- p:

  numeric. Proportion of data to be used for training. Default: 0.7

- method:

  character. Type of model to use for classification or regression.

- parallelComputing:

  logical. indicates whether to also use the parallel processing.
  Default: False

- length:

  integer. Number of values to output for each tuning parameter. If
  `search = "random"` is passed to
  [`trainControl`](https://rdrr.io/pkg/caret/man/trainControl.html)
  through `...`, this becomes the maximum number of tuning parameter
  combinations that are generated by the random search. Default: 10.

- control:

  character. Resampling method to use. Choices include: "boot",
  "boot632", "optimism_boot", "boot_all", "cv", "repeatedcv", "LOOCV",
  "LGOCV", "none", "oob", timeslice, "adaptive_cv", "adaptive_boot", or
  "adaptive_LGOCV". Default: "repeatedcv". See
  [`train`](https://rdrr.io/pkg/caret/man/train.html) for specific
  details on the resampling methods.

- number:

  integer. Number of cross-validation folds or number of resampling
  iterations. Default: 10.

- repeats:

  integer. Number of folds for repeated k-fold cross-validation if
  "repeatedcv" is chosen as the resampling method in `control`. Default:
  10.

- process:

  character. Defines the pre-processing transformation of predictor
  variables to be done. Options are: "BoxCox", "YeoJohnson",
  "expoTrans", "center", "scale", "range", "knnImpute", "bagImpute",
  "medianImpute", "pca", "ica", or "spatialSign". See
  [`preProcess`](https://rdrr.io/pkg/caret/man/preProcess.html) for
  specific details on each pre-processing transformation. Default:
  c('center', 'scale').

- summary:

  expression. Computes performance metrics across resamples. For numeric
  `y`, the mean squared error and R-squared are calculated. For factor
  `y`, the overall accuracy and Kappa are calculated. See
  [`trainControl`](https://rdrr.io/pkg/caret/man/trainControl.html) and
  [`defaultSummary`](https://rdrr.io/pkg/caret/man/postResample.html)
  for details on specification and summary options. Default:
  multiClassSummary.

- classProbs:

  a logical (default : TRUE assuming classification task). It should be
  set to FALSE for regression tasks in conjunction with `summary`
  argument set to "defaultSummary". See examples for more details.

- imbalanceMethod:

  Method for handling imbalanced data ("up", "down"). Default: NULL.

- ...:

  additional arguments to be passed to `createDataPartition`,
  `trainControl` and `train` functions in the package `caret`.

## Value

A list object with results from tuning and training the model selected
in `method`, together with predictions and class probabilities. The
training and test data sets obtained from splitting the data are also
returned in addition to model quality metrics and preformance plots.

If `y` is factor, class probabilities are calculated for each class. If
`y` is numeric, predicted values are calculated.

A ROC curve is created if `y` is factor. Otherwise, a plot of residuals
versus predicted values is created if `y` is numeric.

`tuneTrain` relies on packages `caret`, `ggplot2` and `pROC` to perform
the modelling and plotting.

## Details

Types of classification and regression models available for use with
`tuneTrain` can be found using `names(getModelInfo())`. The results
given depend on the type of model used.

In addition to Model object, Model quality, Tuning and training
datasets,For classification models, class probabilities and ROC curve
are given in the results. For regression models, Variable importance,
predictions and residuals versus predicted plot are given. `y` should be
converted to either factor if performing classification or numeric if
performing regression before specifying it in `tuneTrain`.

Imbalance handling methods "up" and "down" use, respectively, upsample()
and downsample() from caret subsampling methods.

## See also

[`createDataPartition`](https://rdrr.io/pkg/caret/man/createDataPartition.html),
[`trainControl`](https://rdrr.io/pkg/caret/man/trainControl.html),
[`train`](https://rdrr.io/pkg/caret/man/train.html),
[`predict.train`](https://rdrr.io/pkg/caret/man/predict.train.html),
`ovun.sample`,
[`ggplot`](https://ggplot2.tidyverse.org/reference/ggplot.html),
[`auc`](https://rdrr.io/pkg/pROC/man/auc.html),
[`roc`](https://rdrr.io/pkg/pROC/man/roc.html),
[`ggroc`](https://rdrr.io/pkg/pROC/man/ggroc.html),

## Author

Chafik Analy, Khadija Aziz, Zakaria Kehel, Bancy Ngatia, Khadija Aouzal

## Examples

``` r
if (FALSE) { # \dontrun{
# Reading local test datasets
data(DurumWheatDHEWC)
data(BarleyRNOWC)
data(septoriaDurumWC)

## Binary classification of ST_S with balanced data
tree.ST_S <- tuneTrain(data = as.data.frame(septoriaDurumWC),
                     y =  'ST_S',
                     method = 'treebag',
                     summary = multiClassSummary,
                     repeats = 3,
                     classProbs = TRUE)

## Binary classification of RNO with imbalanced data
knn.RNO <- tuneTrain(data = BarleyRNOWC,
                     y =  'RNO',
                     method = 'knn',
                     summary = multiClassSummary,#'                      
                     process = c("scale","center"),
                     classProbs = TRUE,
                     imbalanceMethod ="up",
                     repeats = 3)
                      
## Regression of DHE
svm.DHE <- tuneTrain(data = DurumWheatDHEWC,
                     y =  'DHE',
                     method = 'svmLinear2',
                     summary = defaultSummary,
                     classProbs = FALSE,
                     repeats = 3)
 } # }
```
